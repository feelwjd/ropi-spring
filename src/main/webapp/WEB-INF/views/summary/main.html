<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org">

<body>
<div class="container">
    <div th:replace="/summary/layout/header :: headerFragment"></div>
    <div th:replace="/summary/layout/nav :: navFragment"></div><br><br>

    <div class="row">
        <div class="col-xs-12">
            <a th:href="@{/addSummary}" class="btn btn-success"><i class="material-icons">&#xE147;</i> <span>Add New</span></a>
            <button class="btn btn-danger" th:database="${database}" onclick="deleteAction(this.getAttribute('database'))"><i class="material-icons">&#xE15C;</i> <span>Delete</span></button>
        </div>
    </div>

	<form name="fileForm" action="#" th:action="@{/csvFileUpload}" method="post" enctype="multipart/form-data" accept-charset="UTF-8">
		<div class="row" style="padding : 5px 0px 5px 0px;">
			<div class="col-xs-12">
				<input id="fileInput" style="vertical-align: middle;" type="file" name="file" onchange="changeFile();"/>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-12">
				<button id="fileCancel" type="reset" class="btn btn-link" onclick="resetFile();">취소</button>
				<button id="fileSubmit" type="submit" class="btn btn-primary" disabled="disabled">제출</button>
			</div>
		</div>
	</form>
	 

	<!-- 페이지네이션 -->
	<nav>
		<ul class="pagination">
			<li>
				<a th:href="@{1}" aria-label="Previous">
					<span aria-hidden="true">&laquo;</span>
				</a>
			</li>
			
			<!-- 1페이지 -->
			<th:block th:if="${pagination.curPage <= 1}">
				<li th:classappend="${pagination.curPage == 1 ? 'disabled' : ''}">
					<a th:href="@{#}">이전</a>
				</li>
			</th:block>
			
			<!-- 1페이지 아님 -->
			<th:block th:unless="${pagination.curPage == 1}">
				<li th:classappend="${pagination.curPage == 1 ? 'disabled' : ''}">
					<a th:href="@{{page} (page = ${pagination.curPage})}">이전</a>
				</li>
			</th:block>

			<th:block th:with="start = ${pagination.startPage}, end = ${pagination.endPage}">
				<li th:with="start = ${pagination.startPage}, end = ${pagination.endPage}" th:each="pageButton : ${#numbers.sequence(start, end)}" th:classappend="${pagination.curPage == pageButton  ? 'active' : ''}">
					<a th:href="@{{page} (page = ${pageButton})}" th:text=${pageButton}></a>
				</li>
			</th:block>

			<!-- 끝 페이지 -->	
			<th:block th:if="${pagination.curPage == pagination.pageCnt}"}>
				<li th:classappend="${pagination.curPage == pagination.pageCnt ? 'disabled' : ''}">
					<a th:href="@{#}">다음</a>
				</li>
			</th:block>
			
			<!-- 끝 페이지 아님 -->
			<th:block th:unless="${pagination.curPage == pagination.pageCnt}"}>
				<li th:classappend="${pagination.curPage == pagination.pageCnt ? 'disabled' : ''}">
					<a th:href="@{{page} (page = ${pagination.nextPage})}">다음</a>
				</li>
			</th:block>
			
			<li>
				<a th:href="@{{page} (page = ${pagination.pageCnt})}">
					<span aria-hidden="true">&raquo;</span>
				</a>
			</li>
		</ul>
	</nav>
    <!-- 페이지네이션 -->
    
    <div class="table-responsive">
	    <table class="table table-bordered table-striped">
	        <thead>
	        <tr>
	            <!--<th>
	                <input type="checkbox" class="btn-check" id="selectAll" autocomplete="off" onclick="selectAll(this)" name="symbol">
	                <label class="btn btn-outline-primary" for="selectAll"><b>-ALL-</b></label>
	            </th>-->
	            <th>SYMBOL</th>
	            <th>CountryCode</th>
	            <th>SECTORCODE</th>
	            <th>INDUSTRYCODE</th>
	            <th>KONAME</th>
	            <th>ENNAME</th>
	            <th>CNNAME</th>
	        </tr>
	        </thead>
	        <tbody>
	        <tr th:each="col:${list}" style="cursor: pointer" onclick="">
	            <!--<td>
	                <input type="checkbox" class="btn-check" name="checkRow" th:value="${col.symbol}" th:value2="${col.countrycode}" th:id="${col.symbol}" autocomplete="off">
	                <label class="btn btn-outline-primary" th:for="${col.symbol}">Check</label><br>
	            </td>-->
	            <td th:text="${col.symbol}" th:symbol="${col.symbol}" th:database="${database}" th:country="${col.countrycode}" onclick="rowClicked(this.getAttribute('database'),this.getAttribute('symbol'),this.getAttribute('country'))"></td>
	            <td th:text="${col.countrycode}" th:symbol="${col.symbol}" th:database="${database}" th:country="${col.countrycode}" onclick="rowClicked(this.getAttribute('database'),this.getAttribute('symbol'),this.getAttribute('country'))"></td>
	            <td th:text="${col.sectorcode}" th:symbol="${col.symbol}" th:database="${database}" th:country="${col.countrycode}"  onclick="rowClicked(this.getAttribute('database'),this.getAttribute('symbol'),this.getAttribute('country'))"></td>
	            <td th:text="${col.industrycode}" th:symbol="${col.symbol}" th:database="${database}" th:country="${col.countrycode}"  onclick="rowClicked(this.getAttribute('database'),this.getAttribute('symbol'),this.getAttribute('country'))"></td>
	            <td th:text="${col.koname}" th:symbol="${col.symbol}" th:database="${database}" th:country="${col.countrycode}"  onclick="rowClicked(this.getAttribute('database'),this.getAttribute('symbol'),this.getAttribute('country'))"></td>
	            <td th:text="${col.enname}" th:symbol="${col.symbol}" th:database="${database}" th:country="${col.countrycode}"  onclick="rowClicked(this.getAttribute('database'),this.getAttribute('symbol'),this.getAttribute('country'))"></td>
	            <td th:text="${col.cnname}" th:symbol="${col.symbol}" th:database="${database}" th:country="${col.countrycode}"  onclick="rowClicked(this.getAttribute('database'),this.getAttribute('symbol'),this.getAttribute('country'))"></td>
	        </tr>
	        </tbody>
	    </table>
    </div>
</div>
</body>

</html>

<script>
    function rowClicked(database, symbol, country) {
        location.href = "../detail/" + symbol + '/' + country;
    }
    function selectAll(selectAll)  {
        const checkboxes
            = document.getElementsByName('checkRow');

        checkboxes.forEach((checkbox) => {
            checkbox.checked = selectAll.checked;
        })
    }

    function changeFile(){
    	submitFile = document.getElementById('fileInput');
	    submitBtn = document.getElementById('fileSubmit');

	    if(submitFile.value.length > 0){
	    	submitBtn.disabled = false;
	    }else{
	    	submitBtn.disabled = true;
	    }
    }

    function resetFile(){
    	submitFile = document.getElementById('fileInput');
	    submitBtn = document.getElementById('fileSubmit');

	    submitBtn.disabled = true;
    }

    function deleteAction(database){
        var checkRow = "";
        var checkRow2 = "";
        $( "input[name='checkRow']:checked" ).each (function (){
            checkRow = checkRow + $(this).val()+",";
            checkRow2 = checkRow2 + $(this).attr("value2")+",";
        });
        checkRow = checkRow.substring(0,checkRow.lastIndexOf( ","));
        checkRow2 = checkRow2.substring(0,checkRow2.lastIndexOf( ","));
        if(checkRow == ''){
            alert("�궘�젣�븷 ���긽�쓣 �꽑�깮�븯�꽭�슂.");
            return false;
        }
        console.log(checkRow);
        console.log(checkRow2);

        if(confirm("�젙蹂대�� �궘�젣 �븯�떆寃좎뒿�땲源�?")){

            location.href= "/delete/"+ database +'/'+checkRow+"/"+checkRow2;
        }
    }
</script>
